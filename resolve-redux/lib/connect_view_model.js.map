{"version":3,"sources":["../src/connect_view_model.js"],"names":["mapDispatchToConnectorProps","dispatch","connectViewModel","actions","disconnectViewModel","mapStateToConnectorProps","mapStateToOptions","state","ownProps","connectorOptions","hasOwnProperty","aggregateArgs","Array","isArray","aggregateIds","indexOf","Error","viewModelName","connectorMeta","viewModels","connectorMetaMap","isLoading","isFailure","data","error","Component","ViewModelContainer","componentDidMount","props","componentWillUnmount","componentDidUpdate","prevProps","prevConnectorOptions","render","React","PureComponent","ViewModelConnector","bind"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { connect } from 'react-redux'\nimport { bindActionCreators } from 'redux'\nimport hoistNonReactStatic from 'hoist-non-react-statics'\n\nimport * as actions from './actions'\nimport { connectorMetaMap } from './constants'\nimport getHash from './get_hash'\nimport connectResolveAdvanced from './connect_resolve_advanced'\n\nexport const mapDispatchToConnectorProps = dispatch =>\n  bindActionCreators(\n    {\n      connectViewModel: actions.connectViewModel,\n      disconnectViewModel: actions.disconnectViewModel\n    },\n    dispatch\n  )\n\nexport const mapStateToConnectorProps = (\n  mapStateToOptions,\n  state,\n  ownProps\n) => {\n  const connectorOptions = mapStateToOptions(state, ownProps)\n  if (!connectorOptions.hasOwnProperty('aggregateArgs')) {\n    connectorOptions.aggregateArgs = {}\n  }\n  if (\n    Array.isArray(connectorOptions.aggregateIds) &&\n    connectorOptions.aggregateIds.indexOf('*') !== -1\n  ) {\n    throw new Error(\n      `Incorrect value of \"aggregateIds\". Maybe you meant to use \"*\", not [\"*\"]`\n    )\n  }\n\n  const viewModelName = connectorOptions.viewModelName\n  const aggregateIds = getHash(connectorOptions.aggregateIds)\n  const aggregateArgs = getHash(connectorOptions.aggregateArgs)\n\n  const connectorMeta =\n    state.viewModels &&\n    state.viewModels[connectorMetaMap] &&\n    state.viewModels[connectorMetaMap][\n      `${viewModelName}${aggregateIds}${aggregateArgs}`\n    ]\n      ? state.viewModels[connectorMetaMap][\n          `${viewModelName}${aggregateIds}${aggregateArgs}`\n        ]\n      : {}\n\n  const { isLoading, isFailure } = connectorMeta\n\n  const data =\n    isLoading === false && isFailure === false\n      ? state.viewModels[viewModelName][aggregateIds][aggregateArgs]\n      : null\n\n  const error =\n    isLoading === false && isFailure === true ? connectorMeta.error : null\n\n  return {\n    ownProps,\n    connectorOptions,\n    isLoading,\n    isFailure,\n    data,\n    error\n  }\n}\n\nconst connectViewModel = mapStateToOptions => Component => {\n  class ViewModelContainer extends React.PureComponent {\n    componentDidMount() {\n      const {\n        viewModelName,\n        aggregateIds,\n        aggregateArgs\n        // placeholder,\n        // placeholderTimeout\n      } = this.props.connectorOptions\n\n      this.props.connectViewModel(viewModelName, aggregateIds, aggregateArgs)\n    }\n\n    componentWillUnmount() {\n      const {\n        viewModelName,\n        aggregateIds,\n        aggregateArgs\n        // placeholder,\n        // placeholderTimeout\n      } = this.props.connectorOptions\n\n      this.props.disconnectViewModel(viewModelName, aggregateIds, aggregateArgs)\n    }\n\n    componentDidUpdate(prevProps) {\n      const connectorOptions = this.props.connectorOptions\n      const prevConnectorOptions = prevProps.connectorOptions\n      if (\n        connectorOptions &&\n        prevConnectorOptions &&\n        (prevConnectorOptions.viewModelName !==\n          connectorOptions.viewModelName ||\n          prevConnectorOptions.aggregateIds !== connectorOptions.aggregateIds ||\n          prevConnectorOptions.aggregateArgs !==\n            connectorOptions.aggregateArgs) &&\n        (prevConnectorOptions.viewModelName !==\n          connectorOptions.viewModelName ||\n          getHash(prevConnectorOptions.aggregateIds) !==\n            getHash(connectorOptions.aggregateIds) ||\n          getHash(prevConnectorOptions.aggregateArgs) !==\n            getHash(connectorOptions.aggregateArgs))\n      ) {\n        this.props.disconnectViewModel(\n          prevConnectorOptions.viewModelName,\n          prevConnectorOptions.aggregateIds,\n          prevConnectorOptions.aggregateArgs\n        )\n        this.props.connectViewModel(\n          connectorOptions.viewModelName,\n          connectorOptions.aggregateIds,\n          connectorOptions.aggregateArgs\n        )\n      }\n    }\n\n    render() {\n      const { ownProps, isLoading, data } = this.props\n      return <Component {...ownProps} isLoading={isLoading} data={data} />\n    }\n  }\n\n  const ViewModelConnector = connect(\n    mapStateToConnectorProps.bind(null, mapStateToOptions),\n    mapDispatchToConnectorProps\n  )(ViewModelContainer)\n  ViewModelConnector.mapStateToOptions = mapStateToOptions\n\n  hoistNonReactStatic(ViewModelConnector, ViewModelContainer)\n\n  return connectResolveAdvanced(ViewModelConnector)\n}\n\nexport default connectViewModel\n"],"file":"connect_view_model.js"}